From a184fc93a2f7e1763ec135154f2442aa55a4605b Mon Sep 17 00:00:00 2001
From: Richard W.M. Jones <rjones@redhat.com>
Date: Mon, 3 Sep 2012 11:04:39 +0100
Subject: [PATCH 28/33] EPEL 5: Revert "daemon: remove call to obsolete udevsettle"

This reverts commit b6413f8dbef92c46c4baf9499366716a166f2163.
---
 daemon/guestfsd.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/daemon/guestfsd.c b/daemon/guestfsd.c
index bcb836a..44d7f77 100644
--- a/daemon/guestfsd.c
+++ b/daemon/guestfsd.c
@@ -54,6 +54,7 @@
 #include "daemon.h"
 
 GUESTFSD_EXT_CMD(str_udevadm, udevadm);
+GUESTFSD_EXT_CMD(str_udevsettle, udevsettle);
 
 static char *read_cmdline (void);
 
@@ -1392,11 +1393,18 @@ random_name (char *template)
  *
  * Use 'udevadm settle' after certain commands, but don't be too
  * fussed if it fails.
+ *
+ * 'udevsettle' was the old name for this command (RHEL 5).  This was
+ * deprecated in favour of 'udevadm settle'.  The old 'udevsettle'
+ * command was left as a symlink.  Then in Fedora 13 the old symlink
+ * remained but it stopped working (RHBZ#548121), so we have to be
+ * careful not to assume that we can use 'udevsettle' if it exists.
  */
 void
 udev_settle (void)
 {
   (void) command (NULL, NULL, str_udevadm, "settle", NULL);
+  (void) command (NULL, NULL, str_udevsettle, NULL);
 }
 
 /* Use by the CLEANUP_* macros.  Do not call these directly. */
-- 
1.7.4.1

