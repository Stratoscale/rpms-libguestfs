From 56d9096b21d138709e8815a5dd60ca3a074c9309 Mon Sep 17 00:00:00 2001
From: "Richard W.M. Jones" <rjones@redhat.com>
Date: Mon, 29 Apr 2013 15:22:34 +0100
Subject: [PATCH 2/2] tests: Add a regression test for RHBZ#957772. (cherry
 picked from commit cc93840d31e440e64e27ee13df3afd134ef2e68f)

---
 tests/regressions/Makefile.am   |  1 +
 tests/regressions/rhbz957772.sh | 33 +++++++++++++++++++++++++++++++++
 2 files changed, 34 insertions(+)
 create mode 100755 tests/regressions/rhbz957772.sh

diff --git a/tests/regressions/Makefile.am b/tests/regressions/Makefile.am
index ce02a71..dd9b80f 100644
--- a/tests/regressions/Makefile.am
+++ b/tests/regressions/Makefile.am
@@ -30,6 +30,7 @@ TESTS = \
 	rhbz790721 \
 	rhbz811649.sh \
 	rhbz895904.sh \
+	rhbz957772.sh \
 	test-noexec-stack.pl
 
 tests_not_run = \
diff --git a/tests/regressions/rhbz957772.sh b/tests/regressions/rhbz957772.sh
new file mode 100755
index 0000000..111269a
--- /dev/null
+++ b/tests/regressions/rhbz957772.sh
@@ -0,0 +1,33 @@
+#!/bin/bash -
+# libguestfs
+# Copyright (C) 2013 Red Hat Inc.
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
+
+# Regression test for:
+# https://bugzilla.redhat.com/show_bug.cgi?id=957772
+# Ensure that tar-out and base64-out commands properly quote arguments.
+
+set -e
+export LANG=C
+
+../../fish/guestfish -N fs -m /dev/sda1 <<EOF
+mkdir "/test 1"
+touch "/test 2"
+tar-out "/test 1" /dev/null
+base64-out "/test 2" /dev/null
+EOF
+
+rm test1.img
-- 
1.8.1.4

