From 9f4d530ca5e1cba66039ae25e2472fcebb3bb916 Mon Sep 17 00:00:00 2001
From: Richard W.M. Jones <rjones@redhat.com>
Date: Thu, 30 Aug 2012 18:19:28 +0100
Subject: [PATCH 23/35] EPEL 5: Revert "Mac OS X: Use libtool --mode=execute instead of LD_LIBRARY_PATH"

This reverts commit 61c9ea496e0579bb7d1bcf496595d66c3f08cfec.
---
 ocaml/Makefile.am |   24 ++++++++++++++++--------
 1 files changed, 16 insertions(+), 8 deletions(-)

diff --git a/ocaml/Makefile.am b/ocaml/Makefile.am
index 46acde5..9e07fbc 100644
--- a/ocaml/Makefile.am
+++ b/ocaml/Makefile.am
@@ -112,56 +112,64 @@ noinst_DATA += \
 	$(test_progs:%=%.opt)
 
 bindtests.bc: bindtests.cmo mlguestfs.cma
-	$(top_builddir)/libtool -dlopen $(top_builddir)/src/.libs/libguestfs.la --mode=execute \
+	mkdir -p t
+	LD_LIBRARY_PATH=../src/.libs \
 	$(OCAMLFIND) ocamlc $(OCAMLCFLAGS) -I . -package unix -linkpkg mlguestfs.cma $< -o $@
 
 bindtests.opt: bindtests.cmx mlguestfs.cmxa
 	$(OCAMLFIND) ocamlopt $(OCAMLOPTFLAGS) -cclib -L$(top_builddir)/src/.libs -I . -package unix -linkpkg mlguestfs.cmxa $< -o $@
 
 t/guestfs_005_load.bc: t/guestfs_005_load.cmo mlguestfs.cma
-	$(top_builddir)/libtool -dlopen $(top_builddir)/src/.libs/libguestfs.la --mode=execute \
+	mkdir -p t
+	LD_LIBRARY_PATH=../src/.libs \
 	$(OCAMLFIND) ocamlc $(OCAMLCFLAGS) -I . -package unix -linkpkg mlguestfs.cma $< -o $@
 
 t/guestfs_005_load.opt: t/guestfs_005_load.cmx mlguestfs.cmxa
 	$(OCAMLFIND) ocamlopt $(OCAMLOPTFLAGS) -cclib -L$(top_builddir)/src/.libs -I . -package unix -linkpkg mlguestfs.cmxa $< -o $@
 
 t/guestfs_010_basic.bc: t/guestfs_010_basic.cmo mlguestfs.cma
-	$(top_builddir)/libtool -dlopen $(top_builddir)/src/.libs/libguestfs.la --mode=execute \
+	mkdir -p t
+	LD_LIBRARY_PATH=../src/.libs \
 	$(OCAMLFIND) ocamlc $(OCAMLCFLAGS) -I . -package unix -linkpkg mlguestfs.cma $< -o $@
 
 t/guestfs_010_basic.opt: t/guestfs_010_basic.cmx mlguestfs.cmxa
 	$(OCAMLFIND) ocamlopt $(OCAMLOPTFLAGS) -cclib -L$(top_builddir)/src/.libs -I . -package unix -linkpkg mlguestfs.cmxa $< -o $@
 
 t/guestfs_070_threads.bc: t/guestfs_070_threads.cmo mlguestfs.cma
-	$(top_builddir)/libtool -dlopen $(top_builddir)/src/.libs/libguestfs.la --mode=execute \
+	mkdir -p t
+	LD_LIBRARY_PATH=../src/.libs \
 	$(OCAMLFIND) ocamlc $(OCAMLCFLAGS) -I . -package unix,threads -thread -linkpkg mlguestfs.cma $< -o $@
 
 t/guestfs_070_threads.opt: t/guestfs_070_threads.cmx mlguestfs.cmxa
 	$(OCAMLFIND) ocamlopt $(OCAMLOPTFLAGS) -cclib -L$(top_builddir)/src/.libs -I . -package unix,threads -thread -linkpkg mlguestfs.cmxa $< -o $@
 
 t/guestfs_080_optargs.bc: t/guestfs_080_optargs.cmo mlguestfs.cma
-	$(top_builddir)/libtool -dlopen $(top_builddir)/src/.libs/libguestfs.la --mode=execute \
+	mkdir -p t
+	LD_LIBRARY_PATH=../src/.libs \
 	$(OCAMLFIND) ocamlc $(OCAMLCFLAGS) -I . -package unix -linkpkg mlguestfs.cma $< -o $@
 
 t/guestfs_080_optargs.opt: t/guestfs_080_optargs.cmx mlguestfs.cmxa
 	$(OCAMLFIND) ocamlopt $(OCAMLOPTFLAGS) -cclib -L$(top_builddir)/src/.libs -I . -package unix -linkpkg mlguestfs.cmxa $< -o $@
 
 t/guestfs_400_events.bc: t/guestfs_400_events.cmo mlguestfs.cma
-	$(top_builddir)/libtool -dlopen $(top_builddir)/src/.libs/libguestfs.la --mode=execute \
+	mkdir -p t
+	LD_LIBRARY_PATH=../src/.libs \
 	$(OCAMLFIND) ocamlc $(OCAMLCFLAGS) -I . -package unix -linkpkg mlguestfs.cma $< -o $@
 
 t/guestfs_400_events.opt: t/guestfs_400_events.cmx mlguestfs.cmxa
 	$(OCAMLFIND) ocamlopt $(OCAMLOPTFLAGS) -cclib -L$(top_builddir)/src/.libs -I . -package unix -linkpkg mlguestfs.cmxa $< -o $@
 
 t/guestfs_400_progress.bc: t/guestfs_400_progress.cmo mlguestfs.cma
-	$(top_builddir)/libtool -dlopen $(top_builddir)/src/.libs/libguestfs.la --mode=execute \
+	mkdir -p t
+	LD_LIBRARY_PATH=../src/.libs \
 	$(OCAMLFIND) ocamlc $(OCAMLCFLAGS) -I . -package unix -linkpkg mlguestfs.cma $< -o $@
 
 t/guestfs_400_progress.opt: t/guestfs_400_progress.cmx mlguestfs.cmxa
 	$(OCAMLFIND) ocamlopt $(OCAMLOPTFLAGS) -cclib -L$(top_builddir)/src/.libs -I . -package unix -linkpkg mlguestfs.cmxa $< -o $@
 
 t/guestfs_500_mount_local.bc: t/guestfs_500_mount_local.cmo mlguestfs.cma
-	$(top_builddir)/libtool -dlopen $(top_builddir)/src/.libs/libguestfs.la --mode=execute \
+	mkdir -p t
+	LD_LIBRARY_PATH=../src/.libs \
 	$(OCAMLFIND) ocamlc -custom $(OCAMLCFLAGS) -I . -package unix -linkpkg mlguestfs.cma $< -o $@
 
 t/guestfs_500_mount_local.opt: t/guestfs_500_mount_local.cmx mlguestfs.cmxa
-- 
1.7.4.1

