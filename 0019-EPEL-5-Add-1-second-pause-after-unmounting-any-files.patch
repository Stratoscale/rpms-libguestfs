From 38543d688e3894815088ae98ad200fa5bbc3fdec Mon Sep 17 00:00:00 2001
From: Richard W.M. Jones <rjones@redhat.com>
Date: Fri, 22 Jun 2012 21:58:32 +0100
Subject: [PATCH 19/20] EPEL 5: Add 1 second pause after unmounting any filesystem.

This fixes the test-charset-fidelity test case.  A simpler example
which fails without this is:

  guestfish <<EOF
  sparse test1.img 1G
  run
  part-disk /dev/sda mbr
  mkfs msdos /dev/sda1
  mount /dev/sda1 /
  touch /foo
  umount /
  mkfs ntfs /dev/sda1
  # Next command would fail:
  mount /dev/sda1 /
  vfs-type /dev/sda1 -x
  EOF
---
 daemon/mount.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/daemon/mount.c b/daemon/mount.c
index 0661eb8..6cfe3e3 100644
--- a/daemon/mount.c
+++ b/daemon/mount.c
@@ -216,6 +216,9 @@ do_umount (const char *pathordevice)
 
   free (err);
 
+  /* RHEL 5 only. */
+  sleep (1);
+
   return 0;
 }
 
@@ -376,6 +379,9 @@ do_umount_all (void)
 
   free_stringslen (mounts.argv, mounts.size);
 
+  /* RHEL 5 only. */
+  sleep (1);
+
   return 0;
 }
 
-- 
1.7.4.1

