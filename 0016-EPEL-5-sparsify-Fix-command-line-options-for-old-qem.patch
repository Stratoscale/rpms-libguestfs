From 78511e5332944e4256e6819b323cddb358ed24f9 Mon Sep 17 00:00:00 2001
From: Richard W.M. Jones <rjones@redhat.com>
Date: Fri, 22 Jun 2012 10:24:48 +0100
Subject: [PATCH 16/19] EPEL 5: sparsify: Fix command line options for old qemu-img.

This didn't have -o backing_file etc.  Use old -b and -F options instead.
---
 sparsify/sparsify.ml |   14 ++++++--------
 1 files changed, 6 insertions(+), 8 deletions(-)

diff --git a/sparsify/sparsify.ml b/sparsify/sparsify.ml
index ec3512a..1374662 100644
--- a/sparsify/sparsify.ml
+++ b/sparsify/sparsify.ml
@@ -169,14 +169,12 @@ let overlaydisk =
 
   (* Create it with the indisk as the backing file. *)
   let cmd =
-    let backing_file_option =
-      sprintf "backing_file=%s%s"
-        (replace_str indisk "," ",,")
-        (match format with
-        | None -> ""
-        | Some fmt -> sprintf ",backing_fmt=%s" fmt) in
-    sprintf "qemu-img create -f qcow2 -o %s %s > /dev/null"
-      (Filename.quote backing_file_option) (Filename.quote tmp) in
+    sprintf "qemu-img create -f qcow2%s -b %s %s > /dev/null"
+      (match format with
+       | None -> ""
+       | Some fmt -> sprintf " -F %s" fmt)
+      (replace_str indisk "," ",,")
+      (Filename.quote tmp) in
   if verbose then
     printf "%s\n%!" cmd;
   if Sys.command cmd <> 0 then
-- 
1.7.4.1

